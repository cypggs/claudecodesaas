aW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgdXNlUGFyYW1zIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7CmltcG9ydCB7IEFsZXJ0LCBCdXR0b24sIENhcmQsIENvbCwgTGF5b3V0LCBSb3csIFNwYWNlLCBTcGluLCBUYWcsIFR5cG9ncmFwaHksIG1lc3NhZ2UgfSBmcm9tICdhbnRkJzsKaW1wb3J0IFRleHRBcmVhIGZyb20gJ2FudGQvZXMvaW5wdXQvVGV4dEFyZWEnOwppbXBvcnQgeyBhcGkgfSBmcm9tICcuLi9saWIvYXBpJzsKaW1wb3J0IHsgZXh0cmFjdEVycm9yTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzL2Vycm9yJzsKCmNvbnN0IHsgVGl0bGUsIFRleHQsIFBhcmFncmFwaCB9ID0gVHlwb2dyYXBoeTsKCmludGVyZmFjZSBDbGF1ZGVNZXNzYWdlIHsKICByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JzsKICBjb250ZW50OiBzdHJpbmc7Cn0KCmludGVyZmFjZSBTZXNzaW9uTWV0YSB7CiAgc2x1Zzogc3RyaW5nOwogIHRvdGFsX3J1bnRpbWVfc2Vjb25kczogbnVtYmVyOwp9CgpleHBvcnQgZnVuY3Rpb24gU2Vzc2lvblBhZ2UoKSB7CiAgY29uc3QgeyBzbHVnID0gJycgfSA9IHVzZVBhcmFtczx7IHNsdWc6IHN0cmluZyB9PigpOwogIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpOwogIGNvbnN0IFtzZXNzaW9uTWV0YSwgc2V0U2Vzc2lvbk1ldGFdID0gdXNlU3RhdGU8U2Vzc2lvbk1ldGEgfCBudWxsPihudWxsKTsKICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IHVuZGVmaW5lZD4oKTsKICBjb25zdCBbY29kZSwgc2V0Q29kZV0gPSB1c2VTdGF0ZTxzdHJpbmc+KCIjIENsYXVkZUNvZGUg6Jma5ouf5bel5L2c5Yy6XG5wcmludCgnSGVsbG8gQ2xhdWRlJylcbiIpOwogIGNvbnN0IFtpbnB1dCwgc2V0SW5wdXRdID0gdXNlU3RhdGUoJ+ivt+agueaNruW3puS+p+S7o+eggee7meWHuuW7uuiuricpOwogIGNvbnN0IFtoaXN0b3J5LCBzZXRIaXN0b3J5XSA9IHVzZVN0YXRlPENsYXVkZU1lc3NhZ2VbXT4oW10pOwogIGNvbnN0IFtzdWJtaXR0aW5nLCBzZXRTdWJtaXR0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGNvbnN0IGZldGNoU2Vzc2lvbiA9IGFzeW5jICgpID0+IHsKICAgICAgc2V0TG9hZGluZyh0cnVlKTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGFwaS5mZXRjaFNlc3Npb24oc2x1Zyk7CiAgICAgICAgc2V0U2Vzc2lvbk1ldGEoZGF0YSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIHNldEVycm9yKGV4dHJhY3RFcnJvck1lc3NhZ2UoZXJyLCAn5peg5rOV6I635Y+W5o6I5p2D5L+h5oGvJykpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHNldExvYWRpbmcoZmFsc2UpOwogICAgICB9CiAgICB9OwoKICAgIGlmIChzbHVnKSB7CiAgICAgIHZvaWQgZmV0Y2hTZXNzaW9uKCk7CiAgICB9CiAgfSwgW3NsdWddKTsKCiAgY29uc3QgaGFuZGxlU2VuZCA9IGFzeW5jICgpID0+IHsKICAgIHNldFN1Ym1pdHRpbmcodHJ1ZSk7CiAgICBzZXRFcnJvcih1bmRlZmluZWQpOwogICAgY29uc3QgbWVzc2FnZXMgPSBbCiAgICAgIC4uLmhpc3RvcnksCiAgICAgIHsgcm9sZTogJ3VzZXInIGFzIGNvbnN0LCBjb250ZW50OiBgJHtpbnB1dH1cblxu5b2T5YmN5Luj56CBOlxuJHtjb2RlfWAgfSwKICAgIF07CiAgICB0cnkgewogICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGFwaS5zZW5kQ2xhdWRlTWVzc2FnZXMoc2x1ZywgeyBtZXNzYWdlcywgcnVudGltZV9pbmNyZW1lbnQ6IDYwIH0pOwogICAgICBjb25zdCBhc3Npc3RhbnRDb250ZW50ID0gZXh0cmFjdEFzc2lzdGFudENvbnRlbnQoZGF0YSk7CiAgICAgIGNvbnN0IG5leHRIaXN0b3J5ID0gWy4uLm1lc3NhZ2VzLCB7IHJvbGU6ICdhc3Npc3RhbnQnIGFzIGNvbnN0LCBjb250ZW50OiBhc3Npc3RhbnRDb250ZW50IH1dOwogICAgICBzZXRIaXN0b3J5KG5leHRIaXN0b3J5KTsKICAgICAgc2V0SW5wdXQoJycpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIG1lc3NhZ2UuZXJyb3IoZXh0cmFjdEVycm9yTWVzc2FnZShlcnIsICfosIPnlKggQ2xhdWRlIOWksei0pScpKTsKICAgIH0gZmluYWxseSB7CiAgICAgIHNldFN1Ym1pdHRpbmcoZmFsc2UpOwogICAgfQogIH07CgogIGNvbnN0IHJ1bnRpbWVNaW51dGVzID0gdXNlTWVtbygKICAgICgpID0+IE1hdGgucm91bmQoKChzZXNzaW9uTWV0YT8udG90YWxfcnVudGltZV9zZWNvbmRzID8/IDApIC8gNjApKSwKICAgIFtzZXNzaW9uTWV0YT8udG90YWxfcnVudGltZV9zZWNvbmRzXSwKICApOwoKICBpZiAobG9hZGluZykgewogICAgcmV0dXJuICgKICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJywgYWxpZ25JdGVtczogJ2NlbnRlcicsIG1pbkhlaWdodDogJzEwMHZoJyB9fT4KICAgICAgICA8U3BpbiB0aXA9IuWKoOi9veS4rS4uLiIgLz4KICAgICAgPC9kaXY+CiAgICApOwogIH0KCiAgaWYgKGVycm9yIHx8ICFzZXNzaW9uTWV0YSkgewogICAgcmV0dXJuIDxBbGVydCB0eXBlPSJlcnJvciIgbWVzc2FnZT17ZXJyb3IgPz8gJ+acquaJvuWIsOS8muivnSd9IHNob3dJY29uIHN0eWxlPXt7IG1hcmdpbjogMjQgfX0gLz47CiAgfQoKICByZXR1cm4gKAogICAgPExheW91dCBzdHlsZT17eyBtaW5IZWlnaHQ6ICcxMDB2aCcgfX0+CiAgICAgIDxMYXlvdXQuSGVhZGVyIHN0eWxlPXt7IGRpc3BsYXk6ICdmbGV4JywganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJywgYWxpZ25JdGVtczogJ2NlbnRlcicgfX0+CiAgICAgICAgPFRpdGxlIGxldmVsPXs0fSBzdHlsZT17eyBjb2xvcjogJyNmZmYnLCBtYXJnaW46IDAgfX0+Q2xhdWRlQ29kZSDlt6XkvZzljLo8L1RpdGxlPgogICAgICAgIDxTcGFjZT4KICAgICAgICAgIDxUYWcgY29sb3I9ImJsdWUiPuS8muivnToge3Nlc3Npb25NZXRhLnNsdWd9PC9UYWc+CiAgICAgICAgICA8VGFnIGNvbG9yPSJwdXJwbGUiPue0r+iuoeS9v+eUqDoge3J1bnRpbWVNaW51dGVzfSDliIbpkp88L1RhZz4KICAgICAgICA8L1NwYWNlPgogICAgICA8L0xheW91dC5IZWFkZXI+CiAgICAgIDxMYXlvdXQuQ29udGVudCBzdHlsZT17eyBwYWRkaW5nOiAyNCB9fT4KICAgICAgICA8Um93IGd1dHRlcj17MTZ9PgogICAgICAgICAgPENvbCBzcGFuPXsxNH0+CiAgICAgICAgICAgIDxDYXJkIHRpdGxlPSLku6PnoIHnvJbovpHlmagiPgogICAgICAgICAgICAgIDxUZXh0QXJlYQogICAgICAgICAgICAgICAgcm93cz17Mjh9CiAgICAgICAgICAgICAgICB2YWx1ZT17Y29kZX0KICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZXZlbnQpID0+IHNldENvZGUoZXZlbnQudGFyZ2V0LnZhbHVlKX0KICAgICAgICAgICAgICAgIHN0eWxlPXt7IGZvbnRGYW1pbHk6ICdtb25vc3BhY2UnIH19CiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9DYXJkPgogICAgICAgICAgPC9Db2w+CiAgICAgICAgICA8Q29sIHNwYW49ezEwfT4KICAgICAgICAgICAgPFNwYWNlIGRpcmVjdGlvbj0idmVydGljYWwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0gc2l6ZT0ibGFyZ2UiPgogICAgICAgICAgICAgIDxDYXJkIHRpdGxlPSJDbGF1ZGUg5Lqk5LqSIj4KICAgICAgICAgICAgICAgIDxTcGFjZSBkaXJlY3Rpb249InZlcnRpY2FsIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19PgogICAgICAgICAgICAgICAgICA8VGV4dEFyZWEKICAgICAgICAgICAgICAgICAgICByb3dzPXs0fQogICAgICAgICAgICAgICAgICAgIHZhbHVlPXtpbnB1dH0KICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGV2ZW50KSA9PiBzZXRJbnB1dChldmVudC50YXJnZXQudmFsdWUpfQogICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSLmj4/ov7DkvaDluIzmnJsgQ2xhdWRlIOW4ruS9oOWujOaIkOeahOS7u+WKoSIKICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgPEJ1dHRvbiB0eXBlPSJwcmltYXJ5IiBvbkNsaWNrPXtoYW5kbGVTZW5kfSBsb2FkaW5nPXtzdWJtaXR0aW5nfSBkaXNhYmxlZD17IWlucHV0LnRyaW0oKX0+CiAgICAgICAgICAgICAgICAgICAg5Y+R6YCB5YiwIENsYXVkZQogICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgIDwvU3BhY2U+CiAgICAgICAgICAgICAgPC9DYXJkPgogICAgICAgICAgICAgIDxDYXJkIHRpdGxlPSLlr7nor53orrDlvZUiIHN0eWxlPXt7IG1heEhlaWdodDogJzUwdmgnLCBvdmVyZmxvd1k6ICdhdXRvJyB9fT4KICAgICAgICAgICAgICAgIHtoaXN0b3J5Lmxlbmd0aCA9PT0gMCA/ICgKICAgICAgICAgICAgICAgICAgPFRleHQgdHlwZT0ic2Vjb25kYXJ5Ij7mmoLml6Dlr7nor53vvIzlj5HpgIHor7fmsYLlkI7lsIbmmL7npLrlm57lpI3jgII8L1RleHQ+CiAgICAgICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICAgICBoaXN0b3J5Lm1hcCgoaXRlbSwgaW5kZXgpID0+ICgKICAgICAgICAgICAgICAgICAgICA8Q2FyZCBrZXk9e2luZGV4fSBzaXplPSJzbWFsbCIgc3R5bGU9e3sgbWFyZ2luQm90dG9tOiAxMiB9fSB0eXBlPXtpdGVtLnJvbGUgPT09ICdhc3Npc3RhbnQnID8gJ2lubmVyJyA6IHVuZGVmaW5lZH0+CiAgICAgICAgICAgICAgICAgICAgICA8U3BhY2UgZGlyZWN0aW9uPSJ2ZXJ0aWNhbCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgPFRhZyBjb2xvcj17aXRlbS5yb2xlID09PSAnYXNzaXN0YW50JyA/ICdwdXJwbGUnIDogJ2JsdWUnfT57aXRlbS5yb2xlID09PSAnYXNzaXN0YW50JyA/ICdDbGF1ZGUnIDogJ+S9oCd9PC9UYWc+CiAgICAgICAgICAgICAgICAgICAgICAgIDxQYXJhZ3JhcGggc3R5bGU9e3sgd2hpdGVTcGFjZTogJ3ByZS13cmFwJyB9fT57aXRlbS5jb250ZW50fTwvUGFyYWdyYXBoPgogICAgICAgICAgICAgICAgICAgICAgPC9TcGFjZT4KICAgICAgICAgICAgICAgICAgICA8L0NhcmQ+CiAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgIDwvQ2FyZD4KICAgICAgICAgICAgPC9TcGFjZT4KICAgICAgICAgIDwvQ29sPgogICAgICAgIDwvUm93PgogICAgICA8L0xheW91dC5Db250ZW50PgogICAgPC9MYXlvdXQ+CiAgKTsKfQoKdHlwZSBDbGF1ZGVBcGlSZXNwb25zZSA9IHsKICBjb250ZW50PzogQXJyYXk8eyB0eXBlOiBzdHJpbmc7IHRleHQ/OiBzdHJpbmcgfT47Cn07CgpmdW5jdGlvbiBleHRyYWN0QXNz": ''}