import { create } from 'zustand';
import { api, clearTokens, setTokens } from '../lib/api';
import { extractErrorMessage } from '../utils/error';

export interface User {
  id: string;
  email: string;
  full_name?: string | null;
  role: 'user' | 'admin';
}

type AuthStatus = 'idle' | 'loading' | 'authenticated' | 'unauthenticated';

interface AuthState {
  user: User | null;
  status: AuthStatus;
  error?: string;
  initialize: () => Promise<void>;
  login: (email: string, password: string) => Promise<User>;
  register: (email: string, password: string, fullName?: string) => Promise<User>;
  logout: () => void;
}

export const useAuth = create<AuthState>((set) => ({
  user: null,
  status: 'idle',
  async initialize() {
    set({ status: 'loading' });
    try {
      const response = await api.currentUser();
      set({ user: response.data, status: 'authenticated' });
    } catch (error) {
      set({ user: null, status: 'unauthenticated' });
    }
  },
  async login(email: string, password: string) {
    set({ status: 'loading', error: undefined });
    try {
      const { data } = await api.login({ email, password });
      setTokens({ accessToken: data.access_token, refreshToken: data.refresh_token });
      const userRes = await api.currentUser();
      set({ user: userRes.data, status: 'authenticated' });
      return userRes.data;
    } catch (error) {
      set({ error: extractErrorMessage(error, 'Login failed'), status: 'unauthenticated' });
      throw error;
    }
  },
  async register(email: string, password: string, fullName?: string) {
    set({ status: 'loading', error: undefined });
    try {
      await api.register({ email, password, full_name: fullName });
      const user = await useAuth.getState().login(email, password);
      return user;
    } catch (error) {
      set({ error: extractErrorMessage(error, 'Registration failed'), status: 'unauthenticated' });
      throw error;
    }
  },
  logout() {
    clearTokens();
    set({ user: null, status: 'unauthenticated' });
  },
}));
