from datetime import datetime, timezone

from apscheduler.schedulers.background import BackgroundScheduler

from app.db.session import SessionLocal
from app.models.license import License, LicenseStatus


def start_scheduler() -> BackgroundScheduler:
    scheduler = BackgroundScheduler()

    def expire_licenses_job():
        db = SessionLocal()
        try:
            now = datetime.now(timezone.utc)
            expiring = (
                db.query(License)
                .filter(License.status == LicenseStatus.ACTIVE, License.expires_at <= now)
                .all()
            )
            for lic in expiring:
                lic.status = LicenseStatus.EXPIRED
                for link in lic.session_links:
                    link.is_active = False
                db.add(lic)
            if expiring:
                db.commit()
        finally:
            db.close()

    scheduler.add_job(expire_licenses_job, "interval", minutes=1, id="expire_licenses")
    scheduler.start()
    return scheduler
